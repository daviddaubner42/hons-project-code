<!DOCTYPE html>
<!--This file uses jsPsych version 6.-->

<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Beads experiment</title>

    <script type="text/javascript" src="jspsych-6.1.0/jspsych.js"></script>
    <link rel="stylesheet" type="text/css" href="jspsych-6.1.0/css/jspsych.css"/>
    <script type="text/javascript" src="jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
    <script type="text/javascript" src="jspsych-6.1.0/plugins/jspsych-image-keyboard-response.js"></script>

    <script type="text/javascript" src="jspsych-6.1.0/plugins/jspsych-html-slider-response.js"></script>
    <script type="text/javascript" src="jspsych-6.1.0/plugins/jspsych-fullscreen.js"></script>
    <!-- <script type="text/javascript" src="jspsych-6.1.0/plugins/jspsych-preload.js"></script> -->

    <script type="text/javascript" src="lib/vendors/jquery-2.2.0.min.js"></script>
    <script type="text/javascript" src="jspsych-pavlovia-2020.4_edited.js"></script>

    <style>
        body {overflow: hidden;}
    </style>
</head>
<body>
<script>

    // Creating functions. Most of these are for animations.

    function getRandomInt(max) {
    return Math.floor(Math.random() * max);
    }

    // Functions for the practice trials without the agent
    // Only jar coming onto the screen
    function jarEnteringScreen () {
        // let percentage;
        // for (let step = 0; step < 131; step++) {
        //     percentage = step / 2 - 15;
        //     const change_jar_on = {
        //         type: 'html-keyboard-response',
        //         stimulus: `
        //         <img src='img/jar_covered.png'
        //         style="position:absolute;
        //         top:50%;
        //         left:${percentage}%;
        //         margin-top:-233px;
        //         margin-left:-233px;"/>

        //         <p style="position:absolute; top:90%; left:50%; transform: translate(-50%, -50%);">New jar</p>
        //         `,
        //         choices: "NO_KEYS",
        //         trial_duration: 8,
        //     }
        //     timeline.push(change_jar_on);
        // }
        const jar_agent_still = {
            type: 'html-keyboard-response',
            stimulus: `
            <img src='img/jar_covered.png'
            style="position:absolute;
            top:50%;
            left:45%;
            height: 300px;
            margin-top:-233px;
            margin-left:-233px;"/>

            <img src='img/jar_covered.png'
            style="position:absolute;
            top:50%;
            left:65%;
            height: 300px;
            margin-top:-233px;
            margin-left:-233px;"/>

            
            <p style="position:absolute; top:90%; left:50%; transform: translate(-50%, -50%);">New jar and player</p>
            `,
            choices: "NO_KEYS",
            trial_duration: 800,
        }
        timeline.push(jar_agent_still);
    }

    // Only jar leaving the screen
    function jarLeavingScreen () {
        let percentage;
        for (let step = 0; step < 131; step++) {
            percentage = 50 - step / 2;
            const change_jar_off = {
                type: 'html-keyboard-response',
                stimulus: `

                <img src='img/jar_covered.png'
                style="position:absolute;
                top:50%;
                left:${percentage}%;
                margin-top:-233px;
                margin-left:-233px;"/>

                <p style="position:absolute; top:90%; left:50%; transform: translate(-50%, -50%);">New jar and agent</p>

                `,
                choices: "NO_KEYS",
                trial_duration: 8,
            }
            timeline.push(change_jar_off);
        }
    }

    function participantChoosingBeadsWithoutAgent (participant_beads_img_path) {
        let percentage;
        let hand_img_path;
        for (let step = 0; step < 261; step++) {
            if (step < 100) {
                percentage = step / 2 - 10;
                hand_img_path = 'img/hand_back.png'
            } else {
                percentage = 100 - step / 2;
                hand_img_path = 'img/hand_fist_edited.png'
            }

            const participant_choosing_beads = {
                type: 'html-keyboard-response',
                stimulus: `

                <img src="${hand_img_path}"
                 style="position:absolute;
                 top:${percentage}%;
                 left:50%;
                 transform: translate(-50%, -50%) rotate(180deg);
                 height:300px;
                 width:auto;
                 "/>

                <img src='img/jar_covered_opened.png'
                style="position:absolute;
                top:50%;
                left:53%;
                height: 600px;
                margin-top:-430px;
                margin-left:-290px"/>

                <p style="position:absolute;
                top:90%;
                left:50%;
                transform: translate(-50%, -50%);">You are picking beads</p>

                `,
                choices: "NO_KEYS",
                trial_duration: 2,
            }
            timeline.push(participant_choosing_beads);
        }

        for (let step = 0; step < 131; step++) {
            percentage = 120 - step/2;
            const participant_viewing_beads = {
                type: 'html-keyboard-response',
                stimulus: `

                <img src="${participant_beads_img_path}"
                 style="position:absolute;
                 top:${percentage}%;
                 left:25%;
                 transform: translate(-50%, -50%);
                 height:400px;
                 width:auto;
                 "/>

                <img src='img/jar_covered_opened.png'
                style="position:absolute;
                top:50%;
                left:53%;
                height: 600px;
                margin-top:-430px;
                margin-left:-290px;"/>

                <p style="position:absolute;
                top:90%;
                left:50%;
                transform: translate(-50%, -50%);">You are picking beads</p>

                `,
                choices: "NO_KEYS",
                trial_duration: 2,
            }
            timeline.push(participant_viewing_beads);
        }

    }

    function participantStateConfidenceWithoutAgent (participant_beads_img_path) {
        const participant_stating_confidence = {
            type: 'html-slider-response',
            stimulus: `

            <div style="z-index: -1">

            <img src="${participant_beads_img_path}"
             style="position:absolute;
             top:55%;
             left:25%;
             transform: translate(-50%, -50%);
             height:400px;
             width:auto;
             "/>

            <img src='img/jar_covered_opened.png'
            style="position:absolute;
            z-index: -1;
            top:50%;
            left:53%;
            height:600px;
            margin-top:-430px;
            margin-left:-290px;"/>

            </div>

            <div style="width:200px;
            margin-bottom: 40px;
            margin-top: 50px;">
            <p>Choose your confidence for the colour of the next bead:</p>
            <div style="width:10px; float: left;">
            <p><img src="img/red_bead.png"/></p>
            </div>
            <div style="width:25px; float: right;">
            <p><img src="img/green_bead.png"/></p>
            </div>
            </div>

            `,
            slider_width: 150,
        }
        timeline.push(participant_stating_confidence);
    }

////////////////////////////////////////////////////////////////////////////////////////
    // The functions with an agent.

    // Jar and agent coming onto the screen, and then remaining there for 1 second during practice, and 0.2s during
    // real trials.
    function jarAgentEnteringScreen (agent_img_path, practice) {
        let trialduration1;
        let trialduration2;
        let step_inc;
        if (practice) {
            trialduration1 = 8;
            trialduration2 = 1000;
            step_inc = 2;
        } else {
            trialduration1 = 1;
            trialduration2 = 200;
            step_inc = 4;
        };

        let percentage;
        // for (let step = 0; step < 131; step = step + step_inc) {
        //     percentage = step / 2 - 15;
        //     const change_jar_on = {
        //         type: 'html-keyboard-response',
        //         stimulus: `
        //         <img src='img/jar_covered.png'
        //         style="position:absolute;
        //         top:50%;
        //         left:${percentage}%;
        //         margin-top:-233px;
        //         margin-left:-233px;"/>
                
        //         <img src='img/jar_covered.png'
        //         style="position:absolute;
        //         top:50%;
        //         left:${percentage}%;
        //         margin-top:-233px;
        //         margin-left:-233px;"/>


        //         <p style="position:absolute; top:90%; left:50%; transform: translate(-50%, -50%);">New jar and player</p>
        //         `,
        //         choices: "NO_KEYS",
        //         trial_duration: trialduration1,
        //     }
        //     timeline.push(change_jar_on);
        // }
        const jar_agent_still = {
            type: 'html-keyboard-response',
            stimulus: `
            <img src='img/jar_covered.png'
            style="position:absolute;
            top:50%;
            left:45%;
            height: 300px;
            margin-top:-233px;
            margin-left:-233px;"/>

            <img src='img/jar_covered.png'
            style="position:absolute;
            top:50%;
            left:65%;
            height: 300px;
            margin-top:-233px;
            margin-left:-233px;"/>

            
            <p style="position:absolute; top:90%; left:50%; transform: translate(-50%, -50%);">New jar and player</p>
            `,
            choices: "NO_KEYS",
            trial_duration: trialduration2,
        }
        timeline.push(jar_agent_still);
    }

    // Jar and agent leaving the screen
    function jarAgentLeavingScreen (agent_img_path) {
        let percentage;
        for (let step = 0; step < 131; step++) {
            percentage = 50 - step / 2;
            const change_jar_off = {
                type: 'html-keyboard-response',
                stimulus: `

                <img src='img/jar_covered.png'
                style="position:absolute;
                top:50%;
                left:${percentage}%;
                margin-top:-233px;
                margin-left:-233px;"/>

                <p style="position:absolute; top:90%; left:50%; transform: translate(-50%, -50%);">New jar and agent</p>

                `,
                choices: "NO_KEYS",
                trial_duration: 8,
            }
            timeline.push(change_jar_off);
        }
    }

    function agentChoosingBeads (agent_img_path, practice) {
        let trialduration1;
        let step_inc;
        if (practice) {
            trialduration1 = 6;
            step_inc = 2;
        } else {
            trialduration1 = 0.5;
            step_inc = 4;
        };

        let percentage;
        let hand_img_path;
        for (let step = 0; step < 261; step = step + step_inc) {
            if (step < 100) {
                percentage = step / 2 - 10;
                hand_img_path = 'img/hand_back.png'
                hand_img_path_flipped = 'img/hand_flipped.png'
            } else {
                percentage = 100 - step / 2;
                hand_img_path = 'img/hand_fist_edited.png'
                hand_img_path_flipped = 'img/fist_flipped.png'
            }

            const agent_choosing_beads = {
                type: 'html-keyboard-response',
                stimulus: `

                <img src="${hand_img_path}"
                 style="position:absolute;
                 top:${percentage}%;
                 left:36%;
                 transform: translate(-50%, -50%) rotate(180deg);
                 height:200px;
                 width:auto;
                 "/>
                 <img src="${hand_img_path_flipped}"
                 style="position:absolute;
                 top:${percentage}%;
                 left:44%;
                 transform: translate(-50%, -50%) rotate(180deg);
                 height:200px;
                 width:auto;
                 "/>

                <img src='img/jar_covered_opened.png'
                style="position:absolute;
                top:50%;
                left:45%;
                height: 500px;
                margin-top:-430px;
                margin-left:-290px;"/>

                <img src='img/jar_covered.png'
                style="position:absolute;
                top:50%;
                left:65%;
                height: 300px;
                margin-top:-233px;
                margin-left:-233px;"/>

                <p style="position:absolute;
                top:90%;
                left:50%;
                transform: translate(-50%, -50%);">Player picking beads</p>

                `,
                choices: "NO_KEYS",
                trial_duration: trialduration1,
            }
            timeline.push(agent_choosing_beads);
        }
    }

    function shuffleJars(){
        for(let i = 0; i < 3; i++) {
        for(let step = 0; step < 20; step++) {
            percentage1 = step + 45;
            percentage2 = 65 - step;
            const shuffle_jars = {
                type: 'html-keyboard-response',
                stimulus: `

                <img src="img/jar_covered.png"
                 style="position:absolute;
                 top:50%;
                 left:${percentage1}%;
                 height:300px;
                 margin-top:-233px;
                margin-left:-233px;
                 "/>

                 <img src="img/jar_covered.png"
                 style="position:absolute;
                 top:50%;
                 left:${percentage2}%;
                 height:300px;
                 margin-top:-233px;
                margin-left:-233px;
                 "/>
                 `,
                 choices: "NO_KEYS",
                 trial_duration: 1,
                }
        timeline.push(shuffle_jars);
            }
        }
    }


    function agent_viewing_beads(agent_img_path_1,agent_img_path_2, agent_decision_img_path_1,agent_decision_img_path_2, practice) {
        let trialduration1;
        let trialduration2;
        if (practice) {
            trialduration1 = 800;
            trialduration2 = 1200;
        } else {
            trialduration1 = 100;
            trialduration2 = 800;
        };

        const agent_viewing_beads = {
            type: 'html-keyboard-response',
            stimulus: `

            <img src='img/jar_covered_opened.png'
            style="position:absolute;
            top:50%;
            left:53%;
            height: 600px;
            margin-top:-430px;
            margin-left:-290px;"/>

            <img src="${agent_img_path_1}"
             style="position:absolute;
             top:10%; 
             left:85%;
             height:200px;
             width:auto"/>

             
            <img src="${agent_img_path_2}"
             style="position:absolute;
             top:50%; 
             left:85%;
             height:200px;
             width:auto"/>

             <img src="img/hand_back.png"
             style="position:absolute;
             top:12%;
             left:88%;
             height:120px;
             width:auto;
             "/>

             <img src="img/hand_flipped.png"
             style="position:absolute;
             top:52%;
             left:88%;
             height:120px;
             width:auto;
             "/>

              
            <p style="position:absolute;
            top:90%;
            left:50%;
            transform: translate(-50%, -50%);">Player making a decision</p>

            `,
            choices: "NO_KEYS",
            trial_duration: trialduration1,
        }
        timeline.push(agent_viewing_beads);

        const agent_decided = {
            type: 'html-keyboard-response',
            stimulus: `

            <img src='img/jar_covered_opened.png'
            style="position:absolute;
            top:50%;
            left:53%;
            height: 600px;
            margin-top:-430px;
            margin-left:-290px;"/>


            <img src="${agent_img_path_1}"
            style="position:absolute;
             top:10%;
             left:85%;
             height:200px;
             width:auto;"/>

            <img src="${agent_img_path_2}"
            style="position:absolute;
             top:50%;
             left:85%;
             height:200px;
             width:auto;"/>

             
            <img src="${agent_decision_img_path_1}"
            style="position:absolute;
             top:30%;
             left:70%;
             height:30px;
             width:auto;"/>

             <img src="${agent_decision_img_path_2}"
            style="position:absolute;
             top:70%;
             left:70%;
             height:30px;
             width:auto;"/>


            <p style="position:absolute;
            top:90%;
            left:50%;
            transform: translate(-50%, -50%);">Player making a decision</p>

            `,
            choices: "NO_KEYS",
            trial_duration: trialduration2,
        }
        timeline.push(agent_decided);
    }

    function agentReplacingBeads (agent_img_path_1,agent_img_path_2, agent_decision_img_path_1,agent_decision_img_path_2, practice) {
        let trialduration1;
        let step_inc;
        if (practice) {
            trialduration1 = 8;
            step_inc = 2;
        } else {
            trialduration1 = 0.5;
            step_inc = 4;
        };

        let percentage;
        let hand_img_path;
        for (let step = 0; step < 261; step = step + step_inc) {
            if (step < 100) {
                percentage = step / 2 - 10;
                hand_img_path = 'img/hand_fist_edited.png'
                hand_img_path_flipped = 'img/fist_flipped.png'
            } else {
                percentage = 100 - step / 2;
                hand_img_path = 'img/hand_back.png'
                hand_img_path_flipped = 'img/hand_flipped.png'
            }
            

            const agent_replacing_beads = {
                type: 'html-keyboard-response',
                stimulus: `

                <img src="${hand_img_path}"
                 style="position:absolute;
                 top:${percentage}%;
                 left:46%;
                 transform: translate(-50%, -50%) rotate(180deg);
                 height:200px;
                 width:auto;
                 "/>

                 <img src="${hand_img_path_flipped}"
                 style="position:absolute;
                 top:${percentage}%;
                 left:54%;
                 transform: translate(-50%, -50%) rotate(180deg);
                 height:200px;
                 width:auto;
                 "/>

                <img src='img/jar_covered_opened.png'
                style="position:absolute;
                top:50%;
                left:53%;
                height: 600px;
                margin-top:-430px;
                margin-left:-290px;"/>

                
                <img src="${agent_img_path_1}"
                style="position:absolute;
                top:10%;
                left:85%;
                height:200px;
                width:auto;"/>

                <img src="${agent_img_path_2}"
                style="position:absolute;
                top:50%;
                left:85%;
                height:200px;
                width:auto;"/>


            <img src="${agent_decision_img_path_1}"
            style="position:absolute;
             top:30%;
             left:70%;
             height:30px;
             width:auto;"/>

             <img src="${agent_decision_img_path_2}"
            style="position:absolute;
             top:70%;
             left:70%;
             height:30px;
             width:auto;"/>

                <p style="position:absolute;
                top:90%;
                left:50%;
                transform: translate(-50%, -50%);">Player replacing beads</p>

                `,
                choices: "NO_KEYS",
                trial_duration: trialduration1,
            }
            timeline.push(agent_replacing_beads);
        }
    }

    function participantChoosingBeads (agent_img_path_1,agent_img_path_2, agent_decision_img_path_1,agent_decision_img_path_2, participant_beads_img_path, practice) {
        let trialduration1;
        let step_inc;
        if (practice) {
            trialduration1 = 4;
            step_inc = 2;
        } else {
            trialduration1 = 0.5;
            step_inc = 4;
        };

        let percentage;
        let hand_img_path;
        for (let step = 0; step < 261; step = step + step_inc) {
            if (step < 100) {
                percentage = step / 2 - 10;
                hand_img_path = 'img/hand_back.png'
            } else {
                percentage = 100 - step / 2;
                hand_img_path = 'img/hand_fist_edited.png'
            }

            const participant_choosing_beads = {
                type: 'html-keyboard-response',
                stimulus: `

                <img src="${hand_img_path}"
                 style="position:absolute;
                 top:${percentage}%;
                 left:50%;
                 transform: translate(-50%, -50%) rotate(180deg);
                 height:200px;
                 width:auto;
                 "/>

                <img src='img/jar_covered_opened.png'
                style="position:absolute;
                top:50%;
                left:53%;
                height: 600px;
                margin-top:-430px;
                margin-left:-290px;"/>

                <img src="${agent_img_path_1}"
            style="position:absolute;
             top:10%;
             left:85%;
             height:200px;
             width:auto;"/>

            <img src="${agent_img_path_2}"
            style="position:absolute;
             top:50%;
             left:85%;
             height:200px;
             width:auto;"/>

    
                <p style="position:absolute;
                top:90%;
                left:50%;
                transform: translate(-50%, -50%);">You are picking beads</p>

                `,
                choices: "NO_KEYS",
                trial_duration: trialduration1,
            }
            timeline.push(participant_choosing_beads);
        }

        for (let step = 0; step < 100; step = step + step_inc) {
            percentage = 100 - step/2;
            const participant_viewing_beads = {
                type: 'html-keyboard-response',
                stimulus: `

                <img src="${participant_beads_img_path}"
                 style="position:absolute;
                 top:${percentage}%;
                 left:25%;
                 transform: translate(-50%, -50%);
                 height:300px;
                 width:auto;
                 "/>

                <img src='img/jar_covered_opened.png'
                style="position:absolute;
                top:50%;
                left:53%;
                height: 600px;
                margin-top:-430px;
                margin-left:-290px;"/>

                <img src="${agent_img_path_1}"
            style="position:absolute;
             top:10%;
             left:85%;
             height:200px;
             width:auto;"/>

            <img src="${agent_img_path_2}"
            style="position:absolute;
             top:50%;
             left:85%;
             height:200px;
             width:auto;"/>

            
                <p style="position:absolute;
                top:90%;
                left:50%;
                transform: translate(-50%, -50%);">You are picking beads</p>

                `,
                choices: "NO_KEYS",
                trial_duration: trialduration1,
            }
            timeline.push(participant_viewing_beads);
        }

    }

    function participantStateConfidence (agent_img_path_1,agent_img_path_2, agent_decision_img_path_1,agent_decision_img_path_2, participant_beads_img_path) {
        const participant_stating_confidence = {
            type: 'html-slider-response',
            stimulus: `

            <div style="z-index: -1">

            <img src="${participant_beads_img_path}"
             style="position:absolute;
             top:55%;
             left:25%;
             transform: translate(-50%, -50%);
             height:300px;
             width:auto;
             "/>

            <img src='img/jar_covered_opened.png'
            style="position:absolute;
            z-index: -1;
            top:50%;
            left:53%;
            height: 600px;
            margin-top:-430px;
            margin-left:-290px"/>

            <img src="${agent_img_path_1}"
            style="position:absolute;
             top:10%;
             left:85%;
             height:200px;
             width:auto;"/>

            <img src="${agent_img_path_2}"
            style="position:absolute;
             top:50%;
             left:85%;
             height:200px;
             width:auto;"/>

    
            </div>

            <div style="width:200px;
            margin-bottom: 40px;
            margin-top: 50px;">
            <p style="top:40%;right:0%; position:relative;">Choose your confidence for the jar which the beads are drawn from:</p>
            <div style="width:10px; float: left;">
            <p><img src="img/red_bead.png"/></p>
            </div>
            <div style="width: 25px; float: right;">
            <p><img src="img/green_bead.png"/></p>
            </div>
            </div>

            `,
            slider_width: 150,
            data: {participant_response: true, agent_decision_1: agent_decision_img_path_1, agent_decision_2: agent_decision_img_path_2, beads_shown: participant_beads_img_path},
        }
        timeline.push(participant_stating_confidence);
    }

    function fixation() {
        const fixation = {
            type: 'html-keyboard-response',
            stimulus: `<div style="font-size:60px;">+</div>`,
            choices: "NO_KEYS",
            trial_duration: 1000,
        }
        timeline.push(fixation);
    }

//////////////////////// Begin experiment timeline ///////////////////////////////


    let timeline = [];

    // Function to remove data that is not necessary
    // jsPsych.data.ignore(['trial_type', 'trial_index', 'time_elapsed', 'internal_node_id', 'stimulus', 'key_press', 'success']);

    /* init connection with pavlovia.org */
    const pavlovia_init = {
        type: "pavlovia",
        command: "init"
    };
    timeline.push(pavlovia_init);

    // const preload = {
    //     type: 'preload',
    //     auto_preload: true
    // };
    // timeline.push(preload);

    const welcome = {
        type: 'html-keyboard-response',
        stimulus: "Welcome to the experiment. Press any key to begin."
    }
    timeline.push(welcome);

    const instructions = {
        type: 'html-keyboard-response',
        choices: [' '],
        stimulus: `

        <p>This page contains the instructions for the experiment.</p>

        <p>Please read them carefully.</p>

        <p>There are 2 jars, each of which contains a different number of red and green beads.
         They look something like this:</p>

        <img src="img/jar_40_60.png" alt = "6-4" style="width:10%" float:"left">
        <img src="img/jar_60_40.png" alt="4-6" style="width:10%" float:"right">
        
        <p> The ratio of red:green in the left jar is 60 to 40 and this ratio for the right jar is 40 to 60. </p>

        <p>You will be given one of these jars at random. But, you won't know which jar it is you have been given, as it will be
        presented to you covered, so you can't see the contents of the jar. This would look something like this:</p>

        <p><img src="img/jar_covered.png" style="width:20%"</p>

        <p>You will then draw 8 random beads from the jar. You might draw something that looks like this:</p>

        <p><img src ="img/bead_samples/3red.png"</p>

        <p>Based on these beads, your task is to guess, which jar these beads are drawn from. But you only need to state a confidence, using a confidence bar. The red circle indicates the jar with majority of red beads and the green circle is indication of the jar with majority of green beads. For instance, if you were strongly
        confident that the samples are drawn from the jar with majority of red beads, you might choose to place your guess on the confidence scale like
        so (note that the style of the slider you will see in the experiment might look different to that shown here,
        but that should not make a difference):</p>

        <p><img src="img/agent_choices/5.png"></p>

        <p>If you think it could be a 50-50 chance of either red or green, you might choose to give a confidence like
        this:</p>

        <p><img src="img/agent_choices/50.png"</p>

        <p>After you have taken a guess, the jars will be randomly shuffled, after which you will repeat
        the task.</p>

        <p>Let's do some practice trials, 5 in total. If you're ready to start, and feel that you understand the
         instructions, go ahead and press the 'space' key.</p>

        <p> &lt; Press 'space' to continue &gt; </p>

        `
    }
    timeline.push(instructions);


    const enter_fullscreen = {
    type: 'fullscreen',
    message: '<p>The experiment will switch to full screen mode when you press the button below. You can exit any time by hitting the Esc key.</p>',
    fullscreen_mode: true
    }
    timeline.push(enter_fullscreen);

    // Practice trials, 3 in total, done without an agent

    let bead_samples_path;
    const bead_samples_practice1 = [1, 3, 5, 2, 7];
    for (let trial = 0; trial < 3; trial++) {
        bead_samples_path = 'img/bead_samples/' + bead_samples_practice1[trial] + 'red.png';
        jarEnteringScreen();
        shuffleJars();
        participantChoosingBeadsWithoutAgent(bead_samples_path);
        participantStateConfidenceWithoutAgent(bead_samples_path);
        // fixation();
    }

    const exit_fullscreen = {
    type: 'fullscreen',
    message: '<p>Practice trials completed.</p>',
    fullscreen_mode: false
    }
    // timeline.push(exit_fullscreen);

    const instructions2 = {
        type: 'html-keyboard-response',
        choices: [' '],
        stimulus: `

        <p>Practice trials are over. Hopefully the task was simple enough to grasp. We're now going to add an
        additional element to the task. You will perform the guesswork just like before, but you will do so alongside other players.
        There are 20 players in total, and two new players will be swapped in for each trial. They will take their turn
        first, picking out 8 beads, making a guess, then replacing the beads back into the jar. You'll be able to see the guess they make, but you won't be
        able to see their beads. This should help you in making your own decision, as their guess provides some extra
         information on which jar might be in front of you both.</p>

        <p>We'll run another 3 practice trials, this time with the additional players. If you're ready to start, go
         ahead and press the 'space' key.</p>

        <p> &lt; Press 'space' to continue &gt; </p>

        `
    }
    timeline.push(instructions2);

    // timeline.push(enter_fullscreen);

    let agent_img_path;
    let agent_choice_path;
    let agent_choice_confidence;
    const agent_choices_practice_1 = [15, 50, 30, 20, 90, 50];
    const agent_choices_practice_2 = [20, 40, 50, 15, 70, 60];
    const bead_samples_practice2 = [7, 3, 4, 6, 1];
    for (let trial = 0; trial < 3; trial++) {
        agent_img_path_1 = `img/faces/${trial + 1}.png`;
        agent_img_path_2 = `img/faces/${trial + 2}.png`;

        
        agent_choice_path_1 = 'img/agent_choices/' + agent_choices_practice_1[trial] + '.png';
        agent_choice_path_2 = 'img/agent_choices/' + agent_choices_practice_2[trial] + '.png';
        
        bead_samples_path = 'img/bead_samples/' + bead_samples_practice2[trial] + 'red.png';

        jarAgentEnteringScreen(agent_img_path, true);
        shuffleJars();
        agentChoosingBeads(agent_img_path, true);
        agent_viewing_beads(agent_img_path_1,agent_img_path_2, agent_choice_path_1,agent_choice_path_2, true);
        agentReplacingBeads(agent_img_path_1,agent_img_path_2, agent_choice_path_1,agent_choice_path_2, true);
        participantChoosingBeads(agent_img_path_1,agent_img_path_2, agent_choice_path_1,agent_choice_path_2, bead_samples_path, true);
        participantStateConfidence(agent_img_path_1,agent_img_path_2, agent_choice_path_1,agent_choice_path_2, bead_samples_path, true);
        // // fixation();
    }

    // timeline.push(exit_fullscreen);

    const instructions3 = {
        type: 'html-keyboard-response',
        choices: [' '],
        stimulus: `

        <p>Now you have had a chance to practice the task, we'll do real trials now. It will be greatly speeded up, so
        you can make each guess much more quickly. There will be 115 trials in total. Good luck!</p>

        <p> &lt; Press 'space' to continue &gt; </p>

        `
    }
    timeline.push(instructions3);

    timeline.push(enter_fullscreen);

    // Running the real trials
    // I was going to read the choices and beads directly from the text files. But I'm too lazy, and it seems a little
    // complicated. So for now, I'll just copy and paste them here.
    const agent_choices_trials_1 = [75, 65, 20, 60, 40, 20, 20, 60, 30, 5, 40, 20, 35, 85, 5, 35, 20, 55, 15, 5, 65, 70, 55, 50, 35, 5, 45, 95, 50, 75, 70, 5, 5, 55, 90, 45, 5, 25, 75, 50, 65, 55, 60, 25, 40, 5, 65, 65, 70, 95, 85, 10, 30, 25, 25, 5, 5, 50, 25, 35, 65, 75, 5, 5, 80, 50, 30, 65, 30, 5, 60, 55, 70, 20, 40, 5, 75, 80, 5, 80, 50, 20, 5, 95, 85, 50, 20, 40, 95, 70, 40, 55, 75, 90, 95, 80, 5, 90, 30, 5, 5, 5, 85, 50, 80, 90, 20, 5, 5, 30, 20, 35, 10, 15, 75];

    const agent_choices_trials_2 = [50, 40, 15, 70, 65, 15, 35, 65, 45, 5, 95, 5, 75, 80, 20, 10, 5, 35, 30, 30, 80, 65, 35, 10, 45, 15, 70, 70, 65, 15, 95, 5, 5, 65, 75, 50, 5, 70, 70, 60, 80, 50, 40, 5, 55, 5, 50, 55, 80, 70, 95, 5, 15, 5, 5, 5, 45, 85, 80, 15, 50, 80, 5, 5, 95, 45, 25, 95, 45, 5, 80, 95, 55, 40, 95, 5, 30, 75, 5, 80, 25, 55, 30, 60, 60, 60, 45, 40, 95, 95, 60, 35, 80, 85, 60, 80, 30, 95, 40, 15, 5, 15, 80, 25, 75, 75, 5, 5, 10, 30, 35, 5, 5, 40, 50];

    const bead_samples_trials = [3, 4, 5, 1, 1, 5, 5, 3, 4, 6, 1, 5, 4, 2, 6, 5, 7, 3, 7, 7, 1, 2, 4, 3, 3, 7, 3, 2, 5, 4, 1, 7, 7, 3, 1, 4, 7, 2, 1, 3, 2, 4, 6, 5, 5, 6, 3, 3, 2, 2, 1, 7, 7, 6, 6, 7, 6, 2, 3, 6, 4, 2, 6, 6, 1, 5, 5, 1, 5, 7, 3, 3, 3, 4, 3, 6, 4, 1, 6, 2, 4, 4, 6, 1, 2, 3, 4, 4, 1, 2, 2, 5, 2, 1, 2, 4, 6, 1, 5, 6, 7, 6, 1, 3, 1, 2, 5, 7, 7, 5, 5, 7, 7, 4, 2];
    for (let trial = 0; trial < 115; trial++) {
        agent_img_path_1 = `img/faces/${trial % 19 + 1}.png`;
        agent_img_path_2 = `img/faces/${trial % 19 + 2}.png`;
        agent_choice_path_1 = 'img/agent_choices/' + agent_choices_trials_1[trial] + '.png';
        agent_choice_path_2 = 'img/agent_choices/' + agent_choices_trials_2[trial] + '.png';
        bead_samples_path = 'img/bead_samples/' + bead_samples_trials[trial] + 'red.png';

        jarAgentEnteringScreen(agent_img_path, false);
        shuffleJars();
        agentChoosingBeads(agent_img_path, false);
        agent_viewing_beads(agent_img_path_1,agent_img_path_2, agent_choice_path_1,agent_choice_path_2, false);
        agentReplacingBeads(agent_img_path_1,agent_img_path_2, agent_choice_path_1,agent_choice_path_2, false);
        participantChoosingBeads(agent_img_path_1,agent_img_path_2, agent_choice_path_1,agent_choice_path_2, bead_samples_path, false);
        participantStateConfidence(agent_img_path_1,agent_img_path_2, agent_choice_path_1,agent_choice_path_2, bead_samples_path, false);
        // fixation();
    }

    timeline.push(exit_fullscreen);

    const finished = {
        type: 'html-keyboard-response',
        choices: [' '],
        stimulus: `

        <p>The experiment is now complete. Many thanks for your participation.</p>

        <p> &lt; Press 'space' to exit &gt; </p>

        `
    }
    timeline.push(finished);

    /* finish connection with pavlovia.org */
    const pavlovia_finish = {
        type: "pavlovia",
        command: "finish"
        };
    timeline.push(pavlovia_finish);

    // Getting participant info
    const subject_id = jsPsych.data.getURLVariable('participant');
    jsPsych.data.addProperties({
        subject_id: subject_id,
      });

    /* start the experiment */
    jsPsych.init({
      timeline: timeline,
      on_finish: function(){
        window.location = "https://edinburghinformatics.eu.qualtrics.com/jfe/form/SV_8HtMwj9fQQ1ekh8"
      }
    });



</script>
</body>
</html>
